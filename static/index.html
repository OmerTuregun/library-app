<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Library UI</title>
  <style>
    :root{--bg:#0b1220;--card:#121a2b;--muted:#8797b1;--fg:#e6eefb;--acc:#4ea1ff;--danger:#ff6b6b}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.5 system-ui,Segoe UI,Roboto}
    .wrap{max-width:960px;margin:32px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid #1a2438;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    input,button{height:42px;border-radius:10px;border:1px solid #20304d;background:#0e1627;color:var(--fg);padding:0 12px}
    input:focus{outline:none;border-color:var(--acc)}
    button{cursor:pointer;background:linear-gradient(180deg,#2a72ff,#215be0);border:none}
    button.sec{background:#182338;border:1px solid #20304d}
    button.danger{background:#2a1216;border:1px solid #3a1a1e;color:#ffb3b3}
    .muted{color:var(--muted)}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{padding:10px 12px;text-align:left}
    tr{background:#0f1728;border-radius:12px}
    tr td:first-child, tr th:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    tr td:last-child, tr th:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
    .pill{display:inline-flex;align-items:center;padding:4px 8px;background:#17233b;border:1px solid #20304d;border-radius:999px}
    #toast{position:fixed;right:20px;bottom:20px;min-width:220px;max-width:360px;padding:12px 14px;border-radius:12px;background:#142137;border:1px solid #20304d;display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="margin:8px 0 16px;">📚 Library UI</h1>
    <div class="card" style="padding:16px;">
      <div class="row">
        <input id="isbn" placeholder="ISBN gir (örn: 9780140328721)" style="flex:2" />
        <button id="addBtn">Ekle</button>
        <button class="sec" id="reloadBtn">Yenile</button>
        <span class="muted" id="count" style="align-self:center;margin-left:auto"></span>
      </div>
    </div>

    <div class="card" style="padding:12px;margin-top:16px;overflow-x:auto">
      <table>
        <thead>
          <tr class="muted">
            <th>Başlık</th><th>Yazar</th><th>ISBN</th><th style="width:180px">İşlemler</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <p class="muted" style="margin-top:12px">API: <span class="pill">/books</span> • Doküman: <a href="/docs" style="color:var(--acc)">/docs</a></p>
  </div>

  <div id="toast"></div>

<script>
const T = (msg, ok=true) => {
  const el = document.getElementById('toast');
  el.style.display='block';
  el.style.borderColor = ok ? '#243a63' : '#5c1f27';
  el.style.background = ok ? '#142137' : '#2a1216';
  el.textContent = msg;
  setTimeout(()=>{ el.style.display='none' }, 2200);
};

async function api(path, opts={}) {
  const res = await fetch(path, Object.assign({headers: {'Content-Type':'application/json'}}, opts));
  if (!res.ok) {
    let d; try { d = await res.json(); } catch {}
    throw new Error(d?.detail || res.statusText);
  }
  const ct = res.headers.get('content-type')||'';
  return ct.includes('application/json') ? res.json() : res.text();
}

async function loadBooks(){
  const data = await api('/books');
  const tb = document.getElementById('tbody');
  tb.innerHTML = '';
  data.forEach(b=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input value="${b.title.replaceAll('"','&quot;')}" data-init="${b.title}" data-field="title" style="width:100%"></td>
      <td><input value="${b.author.replaceAll('"','&quot;')}" data-init="${b.author}" data-field="author" style="width:100%"></td>
      <td class="muted">${b.isbn}</td>
      <td>
        <div class="row">
          <button class="sec" data-act="save">Kaydet</button>
          <button class="danger" data-act="del">Sil</button>
        </div>
      </td>`;
    tr.querySelector('[data-act="save"]').onclick = async () => {
      const title = tr.querySelector('input[data-field="title"]').value.trim();
      const author = tr.querySelector('input[data-field="author"]').value.trim();
      const payload = {};
      if (title !== tr.querySelector('input[data-field="title"]').dataset.init) payload.title = title;
      if (author !== tr.querySelector('input[data-field="author"]').dataset.init) payload.author = author;
      if (!Object.keys(payload).length) return T('Değişiklik yok.', true);
      try {
        await api('/books/'+b.isbn, {method:'PUT', body:JSON.stringify(payload)});
        T('Güncellendi ✅'); loadBooks();
      } catch(e){ T(e.message, false); }
    };
    tr.querySelector('[data-act="del"]').onclick = async () => {
      if (!confirm('Silinsin mi?')) return;
      try { await api('/books/'+b.isbn, {method:'DELETE'}); T('Silindi 🗑️'); loadBooks(); }
      catch(e){ T(e.message, false); }
    };
    tb.appendChild(tr);
  });
  document.getElementById('count').textContent = `${data.length} kayıt`;
}

document.getElementById('addBtn').onclick = async () => {
  const isbn = document.getElementById('isbn').value.trim();
  if (!isbn) return T('ISBN girin', false);
  try {
    await api('/books', {method:'POST', body:JSON.stringify({isbn})});
    T('Eklendi ✅'); document.getElementById('isbn').value='';
    loadBooks();
  } catch(e){ T(e.message, false); }
};
document.getElementById('reloadBtn').onclick = loadBooks;
loadBooks();
</script>
</body>
</html>
